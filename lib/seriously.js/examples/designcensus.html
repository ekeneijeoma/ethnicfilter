<!DOCTYPE html>
<html>

<head>
    <title>Seriously.js Camera Demo</title>
    <meta property="og:url"           content="http://www.your-domain.com/your-page.html" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="Your Website Title" />
    <meta property="og:description"   content="Your description" />
    <meta property="og:image"         content="http://www.your-domain.com/path/image.jpg" />
    <style>
    html,
    body {
        width: 100%;
        height: 100%;
        margin: 0px;
    }
    
    .container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translateX(-50%) translateY(-50%);
        font-size: 5em;
        color: white;
        opacity: .5;
        user-select: none;
    }

    </style>
</head>

<body>
<!--     <div class="fb-share-button share" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse">Share</a></div> -->
    <div id="controls">
    <div><label for="amount">Blur</label><input type="range" id="amount" min="0" max="1" step="0.001" value="0.5"/></div>

    <canvas id="canvas" width="640" height="480"></canvas>
    <div id="text" class="container">adfsdsf</div>
    <script src="../seriously.js"></script>
    <script src="../sources/seriously.camera.js"></script>
    <script src="../effects/seriously.blur.js"></script>
    <script>
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    (function() {
        var all = {
            "White": 7205,
            "Hispanic/Latino/Spanish": 998,
            "Asian": 951,
            "Black/African American": 349
                // "Prefer not to answer": 317
        }

        var us = {
            "White": 5925,
            "Asian": 749,
            "Hispanic/Latino/Spanish": 704,
            "Black/African American": 317
                // "Prefer not to answer": 246
        }

        var int = {
            "White": 1280,
            "Hispanic/Latino/Spanish": 294,
            "Asian": 202,
            "Black/African American": 32
                // "Prefer not to answer": 71
        }

        var keys = [
            "White",
            "Hispanic / Latino / Spanish",
            "Asian",
            "Black / African American"
        ]

        var total = 0;
        var min = us[keys[0]];
        var max = 0;
        for (var i in us) {
            total += us[i];
            min = Math.min(min, us[i])
            max = Math.max(max, us[i])
        }

        // "White": 5925,
        // "Asian": 749,
        // "Hispanic/Latino/Spanish": 704,
        // "Black/African American": 317
        min = 317;
        max = 749;
        var index = 0;
        lastAmount = null;
        devicePixelRatio = 1;
        canvas = document.getElementById('canvas');
        canvas.width = window.innerWidth * devicePixelRatio;
        canvas.height = window.innerHeight * devicePixelRatio;
        text = document.getElementById('text');
        text.innerHTML = keys[index]
        seriously = new Seriously();
        var source = seriously.source('camera');    
        target = seriously.target('#canvas'); 
        blur = seriously.effect('blur');
        blur.source = source;
        blur.amount = '#amount';
        reformat = seriously.transform('reformat');
        reformat.width = target.width;
        reformat.height = target.height;
        reformat.mode = 'Cover'; 
        reformat.source = blur;
        target.source = reformat
        

        window.addEventListener( 'resize', onWindowResize, false );
            function onWindowResize() {
            // seriously
            reformat = null
            source = null
            target.destroy()
            target = null
            blur = null
            seriously = new Seriously();
            canvas.width = window.innerWidth * devicePixelRatio;
            canvas.height = window.innerHeight * devicePixelRatio;
            var source = seriously.source('camera');
            blur = seriously.effect('blur');
            blur.source = source;
            blur.amount = lastAmount
            target = seriously.target('#canvas'); 
            reformat = seriously.transform('reformat');
            reformat.source = blur;
            reformat.width = canvas.width;
            reformat.mode = 'Cover';
            reformat.height = canvas.height;
            target.source = reformat


            seriously.go(function(now) {
            var minutes;

            minutes = now / 6000;
            console.log("running")
            // split.angle = (minutes - Math.floor(minutes)) * PI2;
            // split.split = Math.cos(now / 1000) / 2 + 0.5;
        });
        }

        update();

        // seriously.go();
        seriously.go(function(now) {
            var minutes;
            minutes = now / 6000;
            console.log("running")
        });

        document.addEventListener('click', function() { 
            update();
        });

        function update() {
        	index = (++index) % keys.length;
            var value = us[keys[index]];//key of what ever index we are at
            lastAmount = blur.amount = (index == 0) ? 0 : map(value, max, min, 100, 1);
            console.log(blur.amount)
            text.innerHTML = keys[index];

            // blur.amount = (++index)*.01;
            // text.innerHTML = blur.amount;
        }

        function map(n, start1, stop1, start2, stop2) {
            return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2;
        };
    }());
    </script>
</body>

</html>
