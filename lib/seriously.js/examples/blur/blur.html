
<!DOCTYPE html>
<html>
<head>
	<title>Seriously.js Blur Example</title>
	<style type="text/css">
		img {
			display: none;
		}

		#controls {
			display: inline-block;
			vertical-align: top;
		}

		#controls input {
			width: 400px;
		}

		#canvas {
			float: left;
			margin-right: 8px;
			width: 640px;
			height: 619px;
		}


	</style>
</head>
<body>

	<canvas id="canvas" width="640" height="662"></canvas>
	    <div id="text" class="container">adfsdsf</div>
	<div id="controls">
		<div><label for="amount">Blur</label><input type="range" id="amount" min="0" max="1" step="0.001" value="0.5"/></div>
		<button id="button">Oscillate: Start</button>
	</div>
	<script src="../../lib/require.js"></script>
	<script src="../../seriously.js"></script>
    <!-- <script src="../../sources/seriously.camera.js"></script> -->

	<script>
		require.config({
			baseUrl: '../../'
		});

		require([
			'seriously',
			'effects/seriously.blur',
			'sources/seriously.camera'
		], function (Seriously) {
			// declare our variables

	    var all = {
            "White": 7205,
            "Hispanic/Latino/Spanish": 998,
            "Asian": 951,
            "Black/African American": 349
                // "Prefer not to answer": 317
        }

        var us = {
            "White": 5925,
            "Asian": 749,
            "Hispanic/Latino/Spanish": 704,
            "Black/African American": 317
                // "Prefer not to answer": 246
        }

        var int = {
            "White": 1280,
            "Hispanic/Latino/Spanish": 294,
            "Asian": 202,
            "Black/African American": 32
                // "Prefer not to answer": 71
        }

        var keys = [
            "White",
            "Hispanic / Latino / Spanish",
            "Asian",
            "Black / African American"
        ]
        var total = 0;
        var min = us[keys[0]];
        var max = 0;
        for (var i in us) {
            total += us[i];
            min = Math.min(min, us[i])
            max = Math.max(max, us[i])
        }

        // "White": 5925,
        // "Asian": 749,
        // "Hispanic/Latino/Spanish": 704,
        // "Black/African American": 317
        min = 317;
        max = 749;
        PI2 = Math.PI * 2;
        updateValue = 0.8;

        var index = 0;

        // devicePixelRatio = window.devicePixelRatio || 1;
        devicePixelRatio = 1;
        text = document.getElementById('text');
        text.innerHTML = keys[index]

			var seriously, // the main object that holds the entire composition
				blur, // blur effect node
				target, // a wrapper object for our target canvas
				reformat,

				lastRender = 0,
				oscillating = false,
				direction = 1,
				amount,
				x,

				control = document.getElementById('amount'),
				canvas = document.getElementById('canvas'),
		

				devicePixelRatio = window.devicePixelRatio || 1;

			// take advantage of retina/HighDPI display
			canvas.width = 640 * devicePixelRatio;
			canvas.height = 662 * devicePixelRatio;

			seriously = new Seriously();

			var source = seriously.source('camera');

			reformat = seriously.transform('reformat');
			reformat.source = source;
			reformat.width = canvas.width;
			reformat.height = canvas.height;

			blur = seriously.effect('blur');
			blur.source = reformat;
			blur.amount = '#amount';

			target = seriously.target('#canvas');
			target.source = blur;

			seriously.go(function (now) {
				// callback runs before render



				if (oscillating) {
					// if (lastRender) {
					if (amount <= updateValue) {
						oscillating = false;
					}
					// x += direction * (now - lastRender) * Math.PI / 1000;
					// 	amount = (1 - Math.cos(x)) / 2;
					// 	control.value = amount;
					// 	blur.amount = amount;
					// }
				  var minutes;

				// minutes = now / 60000;
				// blur.amount = (minutes - Math.floor(minutes)) * PI2;
				  blur.amount = Math.cos(now / 1000) / 2 + 0.5;
				  console.log(blur.amount);
				// lastRender = now;s
				}
			}, function () {
				// callback runs after render
	
			});

		document.addEventListener('click', function() { 
            update();
        });
        function update() {
        	index = (++index) % keys.length;
            var value = us[keys[index]];//key of what ever index we are at
            blur.amount = (index == 0) ? 0 : map(value, max, min, 100, 1);
            text.innerHTML = keys[index];
        }

        function map(n, start1, stop1, start2, stop2) {
            return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2;
        };

			document.getElementById('button').addEventListener('click', function () {
				update();
				if (oscillating) {
					oscillating = false;
					lastRender = 0;

					// set back to manual control
					blur.amount = control;

					this.innerHTML = 'Oscillate: Start';
				} else {
					oscillating = true;

					// take over manual control
					amount = parseFloat(control.value);

					// figure out where in the oscillating cycle we are
					x = Math.acos(1 - 2 * amount);

					this.innerHTML = 'Oscillate: Stop';
				}
			});
		});
	</script>
</body>
</html>